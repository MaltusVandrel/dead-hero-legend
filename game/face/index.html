<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<script type="text/javascript" src="/lib/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="phaser.min.js"></script>
</head>
<body>
  <!-- https://phaser.io/examples/v3/view/display/masks/bitmapmask-example -->
  <!-- https://phaser.io/examples/v3/view/display/tint/single-color-tint -->

<style>
center *{
  position: fixed;
  left:0;
  display: inline;
}
.color{
  mix-blend-mode: overlay;
  width: 250px;
  height: 250px;
}
.base{
  width: 250px;
  height: 250px;
}
</style>
<center id="face"></center> 
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<div>
  <label for='necks'>Neck</label>
  <select id="necks" onchange="setPart('neck')"></select>
</div>
<div>
  <label for='faces'>Face</label>
  <select id="faces" onchange="setPart('face')"></select>
</div>
<div>
  <label for='hairs'>Hair</label>
  <select id="hairs" onchange="setPart('hair')"></select>
</div>
<div>
  <label for='eyebrows'>Eyebrow</label>
  <select id="eyebrows" onchange="setPart('eyebrow')"></select>
</div>
<div>
  <label for='eyes'>Eye</label>
  <select id="eyes" onchange="setPart('eye')"></select>
</div>
<div>
  <label for='lips'>Lips</label>
  <select id="lips" onchange="setPart('lips')"></select>
</div>
<div>
  <label for='noses'>Nose</label>
  <select id="noses" onchange="setPart('nose')"></select>
</div>
<div>
  <label for='ears'>Ear</label>
  <select id="ears" onchange="setPart('ear')"></select>
</div>
<div>
  <label for='skincolor'>Skin color</label>
  <select id="skincolor" onchange="setColor('skin')"></select>
</div>
<div>
  <label for='eyecolor'>Eye color</label>
  <select id="eyecolor" onchange="setColor('eye')"></select>
</div>
<div>
  <label for='haircolor'>Hair color</label>
  <select id="haircolor" onchange="setColor('hair')"></select>
</div>
<script>
function setPart(selector){ 
  var id=(selector=='lips'?'lip':selector)
  var part = $("#"+id+"s").val();
  head[selector]=part;
  shouldUpdate=true;
}
function setColor(selector){ 
  var color = $("#"+selector+"color").val();
  eval(selector+'Color='+color);
  shouldUpdate=true;
}
function doSelects(){
  for(let key of Object.keys(srcList)){
      let parts = srcList[key];
      let select = $("#"+key.toLowerCase());

      for(let i=0;i<parts.length;i++){
        let part=parts[i];
        select.append("<option value='"+i+"'>"+part.name+"</option>");
      }
  }
  for(let key of skinColors){
    $("#skincolor").append("<option value='"+key+"'>"+key+"</option>");
  }
  for(let key of hairColors){
    $("#haircolor").append("<option value='"+key+"'>"+key+"</option>");
  }
  for(let key of eyeColors){
    $("#eyecolor").append("<option value='"+key+"'>"+key+"</option>");
  }
}

var srcList={
  NECKS:[
    {name:'Basic (M)',src:'neck1.png',genere:'M'},
    {name:'Basic (F)',src:'neck2.png',genere:'F'}
  ],
  FACES:[
    {name:'Face 1',src:'face1.png',genere:'N'},
    {name:'Face 2',src:'face2.png',genere:'N'},
    {name:'Face 3',src:'face3.png',genere:'N'},
    {name:'Face 4',src:'face4.png',genere:'N'},
    {name:'Face 5',src:'face5.png',genere:'N'},
    {name:'Face 6',src:'face6.png',genere:'N'},
    {name:'Face 7',src:'face7.png',genere:'N'},
  ],  
  HAIRS:[
    {name:'Hair 1',src:'hairf1.png',genere:'N',back:'hairb1.png'},
    {name:'Hair 2',src:'hairf2.png',genere:'N',back:'hairb2.png'},
    {name:'Hair 3',src:'hairf3.png',genere:'N'},
    {name:'Hair 4',src:'hairf4.png',genere:'N'},
    {name:'Hair 5',src:'hairf5.png',genere:'N'},
    {name:'Hair 6',src:'hairf6.png',genere:'N'},
    {name:'Hair 7',src:'hairf7.png',genere:'N'},
    {name:'Hair 8',src:'hairf8.png',genere:'N'},
    {name:'Hair 9',src:'hairf9.png',genere:'N'},
    {name:'Hair 10',src:'hairf10.png',genere:'N'},
    {name:'Hair 11',src:'hairf11.png',genere:'N'},
    {name:'Hair 12',src:'hairf12.png',genere:'N'},
    {name:'Hair 13',src:'hairf13.png',genere:'N'},
    {name:'Hair 14',src:'hairf14.png',genere:'N'},
    {name:'Hair 15',src:'hairf15.png',genere:'N'},
    {name:'Hair 16',src:'hairf16.png',genere:'N'},
    {name:'Hair 17',src:'hairf17.png',genere:'N'},
  ],
  NOSES:[
    {name:'Nose 1',src:'nose1.png',genere:'N'},
    {name:'Nose 2',src:'nose2.png',genere:'N'},
    {name:'Nose 3',src:'nose3.png',genere:'N'},
    {name:'Nose 4',src:'nose4.png',genere:'N'},
    {name:'Nose 5',src:'nose5.png',genere:'N'},
    {name:'Nose 6',src:'nose6.png',genere:'N'},
    {name:'Nose 7',src:'nose7.png',genere:'N'},
    {name:'Nose 8',src:'nose8.png',genere:'N'},
  ],
  LIPS:[
    {name:'Lips 1',src:'lips1.png',genere:'N'},
    {name:'Lips 2',src:'lips2.png',genere:'N'},
    {name:'Lips 3',src:'lips3.png',genere:'N'},
    {name:'Lips 4',src:'lips4.png',genere:'N'},
  ],
  EYES:[
    {name:'Eye 1',iris:'iris1.png',sclera:'sclera1.png',genere:'N'},
    {name:'Eye 2',iris:'iris2.png',sclera:'sclera2.png',genere:'N'},
    {name:'Eye 3',iris:'iris3.png',sclera:'sclera3.png',genere:'N'},
    {name:'Eye 4',iris:'iris4.png',sclera:'sclera4.png',genere:'N'},
    {name:'Eye 5',iris:'iris5.png',sclera:'sclera5.png',genere:'N'},
  ],
  EYEBROWS:[
    {name:'Eyebrow 1',src:'eyebrow1.png',genere:'N'},
    {name:'Eyebrow 2',src:'eyebrow2.png',genere:'N'},
    {name:'Eyebrow 3',src:'eyebrow3.png',genere:'N'},
    {name:'Eyebrow 4',src:'eyebrow4.png',genere:'N'},
  ],
  EARS:[
    {name:'Ear 1',src:'ear1.png',genere:'N'},
    {name:'Ear 2',src:'ear2.png',genere:'N'},
    {name:'Ear 3',src:'ear3.png',genere:'N'},
    {name:'Ear 4',src:'ear4.png',genere:'N'},
    {name:'Ear 5',src:'ear5.png',genere:'N'},
    {name:'Ear 6',src:'ear6.png',genere:'N'},
  ],
  
};

var skinColors=[
0x8d5524,
0xc68642,
0xe0ac69,
0xf1c27d,
0xffdbac,
0xffbba4
];
var eyeColors=[
0x734e34,
0x635e34,
0x7fb4be,
0x19a337
];
var hairColors=[
0x241c11,
0x4f1a00,
0x9a3300,
0xE6C882,
0xFFCC47,
0x996515
];



var skinColor=0x8d5524;
var eyeColor=0x19a337;
var hairColor=0x9a3300;

var head={
    hair:0,
    face:0,
    nose:0,
    lips:0,
    ear:0,
    eye:0,
    eyebrow:0,
    neck:0
  };

  var config = {
    type: Phaser.WEBGL,
    parent: 'face',
    width: 250,
    height: 250,
    scene: {
        preload: preload,
        create: create,
        update:update
    }
  };

var phaserGame = new Phaser.Game(config);
function removeExtension(src){
  return src.split('.')[0];
}

function preload ()
{
    for(let key of Object.keys(srcList)){
      let parts = srcList[key];
      for(let part of parts){
        if(part.src)this.load.image(part.src, (part.src));
        if(part.back)this.load.image(part.back, ( part.back));
        if(part.iris)this.load.image(part.iris, (part.iris));
        if(part.sclera)this.load.image(part.sclera, (part.sclera));
      }
    }
    
}
var drawedHead={};
function drawOrder(){
  var order=[];
  if(srcList.HAIRS[head.hair].back!=undefined)order.push({type:'hairB',src:srcList.HAIRS[head.hair].back,color:hairColor});
  order.push({type:'neck',src:srcList.NECKS[head.neck].src,color:skinColor});
  order.push({type:'face',src:srcList.FACES[head.face].src,color:skinColor});
  order.push({type:'nose',src:srcList.NOSES[head.nose].src,color:skinColor});
  order.push({type:'lips',src:srcList.LIPS[head.lips].src,color:skinColor});
  
  order.push({type:'sclera',src:srcList.EYES[head.eye].sclera});
  order.push({type:'iris',src:srcList.EYES[head.eye].iris,color:eyeColor});
  order.push({type:'eyebrow',src:srcList.EYEBROWS[head.eyebrow].src,color:hairColor});

  order.push({type:'hair',src:srcList.HAIRS[head.hair].src,color:hairColor});
  order.push({type:'ear',src:srcList.EARS[head.ear].src,color:skinColor});
  return order;
}
function create (){
  draw(this);
}
var a=0;
var shouldUpdate=false;
function update (){
  if(shouldUpdate){
    console.log(a++);
    clear();
    draw(this);
    shouldUpdate=false;
  }
}
function clear(){
  for(let key of Object.keys(drawedHead)){
    let part=drawedHead[key];
    part.image.destroy();
  }
}
function draw (phaser)
{
 
    drawedHead={}
    var hsv = Phaser.Display.Color.HSVColorWheel();

    for(var part of drawOrder()){
      var image = phaser.add.image(0, 0, part.src);     
      image.setOrigin(0, 0);
      image.setScale(.5);
      if(part.color)image.setTint(part.color);
      
      drawedHead[part.type]={... part, image:image};
    }
    
/*    

    this.input.on('pointerdown', function (pointer) {

        var i = Phaser.Math.Between(0, 359);

        image.setTint(hsv[i].color);

    });
*/    
}
doSelects();
</script>

<!--  

  function draw(){
  
  
  let last=true;
  $("#face").html('');
  for(let i=0;i<drawList.length;i++){
    let source=drawList[i];
    $("#face").append("<img src='"+source.src+"' class='base'/>");
    $("#face").append("<canvas id='c"+i+"' class='color'></canvas>");
    let c = $("#c"+i)[0];
    let ctx = c.getContext("2d");
    let img = new Image; img.onload =()=>{
      ctx.fillStyle = source.color;
      ctx.fillRect(0, 0, c.width, c.height);  
      ctx.globalCompositeOperation = "destination-in";  
      ctx.drawImage(img, 0, 0,img.width,img.height,0,0,c.width,c.height); 
    }; 
    img.src = source.src;
    
  }
}
draw();

-->
</body>
</html>